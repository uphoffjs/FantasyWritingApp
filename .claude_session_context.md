# Claude Session Context - Cypress Compliance Work
*Last Updated: 2025-09-22*

## Current Session Summary

### Work Completed
- **Documentation Analysis**: Reviewed cypress-best-practices.md and ADVANCED-TESTING-STRATEGY.md
- **Compliance Audit**: Analyzed 70+ component test files in `/cypress/component/`
- **Tool Development**: Created automated fix and validation scripts
- **Documentation**: Comprehensive compliance guide and remediation plan

### Critical Findings

#### Compliance Issues (Current State: ~5% compliant)
1. **Selector Issues (100% non-compliant)**:
   - All tests use `data-testid` instead of required `data-cy`
   - React Native components use `testID` prop (converts to `data-cy` on web)

2. **Debug Command Issues (95% non-compliant)**:
   - Missing `cy.comprehensiveDebug()` in beforeEach hooks
   - Missing `cy.cleanState()` for state management
   - No failure capture in afterEach hooks

3. **Test Structure Issues (90% non-compliant)**:
   - Missing documentation headers with user stories
   - Presence of forbidden if/else statements
   - Console.log statements left in code

#### Technical Requirements Identified
```javascript
// MANDATORY test structure
describe('Component', () => {
  beforeEach(function() {
    cy.comprehensiveDebug();  // MANDATORY
    cy.cleanState();          // MANDATORY
    cy.visit('/');
  });

  afterEach(function() {
    if (this.currentTest.state === 'failed') {
      cy.captureFailureDebug();  // MANDATORY
    }
  });
});
```

### Deliverables Created

#### 1. Task Management (`/cypress/support/TODO.md`)
- **P0 Tasks**: Critical compliance fixes (selectors, debug commands)
- **P1 Tasks**: Structure improvements (hooks, documentation)
- **P2 Tasks**: Code quality (remove console.log, if statements)
- **P3 Tasks**: Enhancement features (accessibility, performance)

#### 2. Automation Tools
- **`fix-compliance.js`**: Automated fixes for common patterns
- **`validate-compliance.js`**: Compliance checking script
- Both require `npm install --save-dev glob`

#### 3. Documentation (`/cypress/support/COMPLIANCE-README.md`)
- Complete implementation guide
- Testing patterns and requirements
- React Native web-specific considerations

### Project Technical Context

#### Stack Details
- **Framework**: React Native 0.75.4 + TypeScript 5.2.2
- **State Management**: Zustand with AsyncStorage
- **Testing**: Cypress (web E2E + component tests)
- **Navigation**: React Navigation 6
- **Backend**: Supabase

#### Current Branch Status
- **Branch**: `feature/element-enhancements` (not main)
- **Status**: Clean working tree
- **Last Commit**: 73d94c4 - Merge feature/update-projects-page into dev

#### Key File Locations
```
cypress/
├── component/           # 70+ test files needing compliance fixes
├── support/
│   ├── TODO.md         # Prioritized task list
│   ├── fix-compliance.js    # Automated fix script
│   ├── validate-compliance.js  # Validation script
│   └── COMPLIANCE-README.md    # Implementation guide
├── e2e/                # E2E tests (separate from component tests)
└── cypress.config.js   # Configuration
```

### React Native Web Testing Patterns

#### Component Testing Approach
```javascript
// React Native component with testID
<TouchableOpacity testID="submit-button">
  <Text>Submit</Text>
</TouchableOpacity>

// Cypress test (web platform)
cy.get('[data-cy="submit-button"]').click();
```

#### Platform-Specific Considerations
- `testID` prop on React Native components
- Automatic conversion to `data-cy` on web platform
- No CSS selectors (classes, IDs) in tests
- Touch events vs click events

### Next Session Action Items

#### Immediate Tasks (Next Session)
1. **Install Dependencies**:
   ```bash
   npm install --save-dev glob
   ```

2. **Run Validation**:
   ```bash
   node cypress/support/validate-compliance.js
   ```

3. **Apply Automatic Fixes**:
   ```bash
   node cypress/support/fix-compliance.js
   ```

4. **Manual Review Required**:
   - Remove if/else statements in tests
   - Remove console.log statements
   - Add proper documentation headers
   - Validate testID → data-cy selector mappings

#### Success Criteria
- **Validation Script**: 0 compliance errors
- **Test Execution**: All component tests pass
- **Lint Check**: `npm run lint` passes
- **Documentation**: All tests have proper headers

### Key Learnings

#### Cypress Component Testing Requirements
- **Session Management**: Use `cy.session()` with validation
- **State Management**: `cy.cleanState()` between tests
- **Debug Infrastructure**: Comprehensive failure capture
- **Selector Strategy**: data-cy only, no CSS selectors

#### React Native Web Integration
- Components render to web DOM with testID → data-cy conversion
- Touch events work on web platform
- Platform-specific code uses `Platform.select()`
- AsyncStorage maps to localStorage on web

### Risk Factors
- **High Volume**: 70+ test files need manual review
- **Breaking Changes**: Selector changes may break existing tests
- **Integration**: Component tests must work with E2E test infrastructure
- **Performance**: Debug commands add overhead but required for compliance

### Success Indicators
- All component tests use `data-cy` selectors
- 100% compliance with debug command requirements
- No forbidden patterns (if/else, console.log)
- Complete documentation headers
- Automated validation passes

---
*This context enables efficient continuation of Cypress compliance work across sessions*